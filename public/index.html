<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZalypaSPB - Панель управления</title>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="/assets/css/style.css?v=20251107-1">
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="login-box">
            <h1>ZalypaSPB</h1>
            <p>Панель управления</p>
            
            <div id="loginError" class="error-message hidden"></div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">Имя пользователя</label>
                    <input type="text" id="username" required autocomplete="username">
                </div>
                
                <div class="form-group">
                    <label for="password">Пароль</label>
                    <input type="password" id="password" required autocomplete="current-password">
                </div>
                
                <button type="submit" class="btn">Войти</button>
            </form>
            <div class="auth-switch" style="margin-top:10px; text-align:center;">
                <button id="btnShowRegister" type="button" class="link-btn" style="background:none;border:none;color:#FF9800;cursor:pointer;">Регистрация по инвайту</button>
            </div>

            <div id="registerError" class="error-message hidden"></div>

            <form id="registerForm" class="hidden">
                <div class="form-group">
                    <label for="regUsername">Имя пользователя</label>
                    <input type="text" id="regUsername" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label for="regEmail">Email (необязательно)</label>
                    <input type="email" id="regEmail" autocomplete="email">
                </div>
                <div class="form-group">
                    <label for="regPassword">Пароль</label>
                    <input type="password" id="regPassword" required autocomplete="new-password">
                </div>
                <div class="form-group">
                    <label for="regInvite">Инвайт</label>
                    <input type="text" id="regInvite" required>
                </div>
                <button type="submit" class="btn">Зарегистрироваться</button>
                <div class="auth-switch" style="margin-top:10px; text-align:center;">
                    <button id="btnShowLogin" type="button" class="link-btn" style="background:none;border:none;color:#FF9800;cursor:pointer;">У меня уже есть аккаунт</button>
                </div>
            </form>
            
        </div>
    </div>

    <!-- User Dashboard -->
    <div id="userDashboard" class="dashboard">
        <div class="container">
            <div class="header">
                <div class="header-left">
                    <div class="logo">ZalypaSPB</div>
                </div>
                <div class="user-info">
                    <span class="user-badge">User</span>
                    <span id="userUsername"></span>
                    <button class="btn-logout">Выход</button>
                </div>
            </div>

            <div id="adminLoader" class="content-section">
                <div class="table-container">
                    <div class="table-header">
                        <h2 class="table-title">Загрузка лоадера</h2>
                    </div>
                    <div class="settings-section">
                        <div class="settings-title">Новый релиз</div>
                        <form id="adminUploadLoaderForm" enctype="multipart/form-data">
                            <div class="form-group">
                                <label for="ldrVersion">Версия</label>
                                <input type="text" id="ldrVersion" required placeholder="например, 1.2.3">
                            </div>
                            <div class="form-group">
                                <label for="ldrFile">Файл</label>
                                <input type="file" id="ldrFile" required>
                            </div>
                            <div class="form-group">
                                <label for="ldrChecksum">SHA-256 (опционально)</label>
                                <input type="text" id="ldrChecksum" placeholder="если не указать — посчитается автоматически">
                            </div>
                            <div style="display:flex; gap:10px; flex-wrap:wrap;">
                                <button type="submit" class="btn btn-inline">Загрузить</button>
                                <button type="button" class="btn btn-inline" data-section="adminLoader">Обновить список</button>
                            </div>
                            <div id="adminLoaderMsg" class="error-message hidden" style="margin-top:10px;"></div>
                        </form>
                    </div>
                    <div class="table-header" style="margin-top:24px;">
                        <h2 class="table-title">Релизы</h2>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Версия</th>
                                <th>Файл</th>
                                <th>SHA-256</th>
                                <th>Создан</th>
                                <th>Действия</th>
                            </tr>
                        </thead>
                        <tbody id="adminLoaderReleasesTable"></tbody>
                    </table>
                </div>
            </div>

            

            <div class="navigation">
                <button class="nav-btn active" data-section="userLoader">Loader</button>
                <button class="nav-btn" data-section="userProducts">Продукты</button>
                <button class="nav-btn" data-section="userStatistics">Статистика</button>
                <button class="nav-btn" data-section="userTelegram">Telegram</button>
                <button class="nav-btn" data-section="userSettings">Настройки</button>
            </div>

            <div id="userLoader" class="content-section active">
                <div class="loader-widget">
                    <div class="loader-spinner"></div>
                    <div class="loader-text">Загрузка данных...</div>
                </div>
            </div>

            <div id="userProducts" class="content-section">
                <div class="table-container">
                    <div class="table-header">
                        <h2 class="table-title">Мои продукты</h2>
                    </div>
                    <div id="userProductsList" class="products-grid"></div>
                </div>
            </div>

            <div id="userStatistics" class="content-section">
                <div class="cards-grid">
                    <div class="card">
                        <div class="card-title">Активных продуктов</div>
                        <div class="card-value">2</div>
                        <div class="card-subtitle">Premium &amp; Basic</div>
                    </div>
                    <div class="card">
                        <div class="card-title">Последний вход</div>
                        <div class="card-value" style="font-size: 20px;">Сегодня</div>
                        <div class="card-subtitle">20:00 +07</div>
                    </div>
                    <div class="card">
                        <div class="card-title">Использование</div>
                        <div class="card-value">85%</div>
                        <div class="card-subtitle">Активность</div>
                    </div>
                </div>
            </div>

            <div id="userTelegram" class="content-section">
                <div class="table-container">
                    <div class="table-header">
                        <h2 class="table-title">Telegram</h2>
                    </div>
                    <div id="userTelegramContainer"></div>
                </div>
            </div>

            <div id="userSettings" class="content-section">
                <div class="table-container">
                    <div class="table-header">
                        <h2 class="table-title">Настройки аккаунта</h2>
                    </div>
                    <form id="userChangePasswordForm">
                        <div class="form-group">
                            <label for="userCurrentPassword">Текущий пароль (если установлен)</label>
                            <input type="password" id="userCurrentPassword" autocomplete="current-password">
                        </div>
                        <div class="form-group">
                            <label for="userNewPassword">Новый пароль</label>
                            <input type="password" id="userNewPassword" required autocomplete="new-password">
                        </div>
                        <div class="form-group">
                            <label for="userNewPassword2">Подтверждение пароля</label>
                            <input type="password" id="userNewPassword2" required autocomplete="new-password">
                        </div>
                        <button type="submit" class="btn">Сменить пароль</button>
                        <div id="userSettingsMsg" class="error-message hidden"></div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Reseller Dashboard -->
    <div id="resellerDashboard" class="dashboard">
        <div class="container">
            <div class="header">
                <div class="header-left">
                    <div class="logo">ZalypaSPB</div>
                </div>
                <div class="user-info">
                    <span class="user-badge" style="background: rgba(255, 152, 0, 0.2); color: #FF9800;">Reseller</span>
                    <span id="resellerUsername"></span>
                    <button class="btn-logout">Выход</button>
                </div>
            </div>

            <div class="navigation">
                <button class="nav-btn active" data-section="resellerUsers">Пользователи</button>
                <button class="nav-btn" data-section="resellerProducts">Продукты</button>
                <button class="nav-btn" data-section="resellerStatistics">Статистика</button>
                <button class="nav-btn" data-section="resellerTelegram">Telegram</button>
            </div>

            <div id="resellerUsers" class="content-section active">
                <div class="table-container">
                    <div class="table-header">
                        <h2 class="table-title">Управление пользователями</h2>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Имя пользователя</th>
                                <th>Email</th>
                                <th>Статус</th>
                                <th>Действия</th>
                            </tr>
                        </thead>
                        <tbody id="resellerUsersTable"></tbody>
                    </table>
                </div>
            </div>

            <div id="resellerProducts" class="content-section">
                <div class="table-container">
                    <div class="table-header">
                        <h2 class="table-title">Управление продуктами</h2>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Название</th>
                                <th>Тип</th>
                                <th>Цена</th>
                                <th>Действия</th>
                            </tr>
                        </thead>
                        <tbody id="resellerProductsTable"></tbody>
                    </table>
                </div>
            </div>

            <div id="resellerStatistics" class="content-section">
                <div class="cards-grid">
                    <div class="card">
                        <div class="card-title">Всего пользователей</div>
                        <div class="card-value" id="resellerUserCount">0</div>
                        <div class="card-subtitle">Активных клиентов</div>
                    </div>
                    <div class="card">
                        <div class="card-title">Всего продуктов</div>
                        <div class="card-value" id="resellerProductCount">0</div>
                        <div class="card-subtitle">Доступных ключей</div>
                    </div>
                    <div class="card">
                        <div class="card-title">Доход</div>
                        <div class="card-value" style="font-size: 24px;">₽45,000</div>
                        <div class="card-subtitle">За месяц</div>
                    </div>
                </div>
            </div>

            <div id="resellerTelegram" class="content-section">
                <div class="table-container">
                    <div class="table-header">
                        <h2 class="table-title">Telegram</h2>
                    </div>
                    <div id="resellerTelegramContainer"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="dashboard">
        <div class="container">
            <div class="header">
                <div class="header-left">
                    <div class="logo">ZalypaSPB</div>
                </div>
                <div class="user-info">
                    <span class="user-badge" style="background: rgba(33, 150, 243, 0.2); color: #2196F3;">Admin</span>
                    <span id="adminUsername"></span>
                    <button class="btn-logout">Выход</button>
                </div>
            </div>

            <div class="navigation">
                <button class="nav-btn active" data-section="adminUsers">Все пользователи</button>
                <button class="nav-btn" data-section="adminResellers">Реселлеры</button>
                <button class="nav-btn" data-section="adminProducts">Продукты</button>
                <button class="nav-btn" data-section="adminLoader">Loader</button>
                <button class="nav-btn" data-section="adminInvites">Инвайты</button>
                <button class="nav-btn" data-section="adminLogs">Логи аудита</button>
                <button class="nav-btn" data-section="adminSettings">Настройки</button>
                <button class="nav-btn" data-section="adminTelegram">Telegram</button>
            </div>

            <div id="adminUsers" class="content-section active">
                <div class="table-container">
                    <div class="table-header">
                        <h2 class="table-title">Все пользователи системы</h2>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Имя пользователя</th>
                                <th>Роль</th>
                                <th>Email</th>
                                <th>Статус</th>
                                <th>Действия</th>
                            </tr>
                        </thead>
                        <tbody id="adminUsersTable"></tbody>
                    </table>
                </div>
            </div>

            <div id="adminResellers" class="content-section">
                <div class="table-container">
                    <div class="table-header">
                        <h2 class="table-title">Реселлеры</h2>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Имя</th>
                                <th>Email</th>
                                <th>Статус</th>
                                <th>Баланс</th>
                                <th>Действия</th>
                            </tr>
                        </thead>
                        <tbody id="adminResellersTable"></tbody>
                    </table>
                </div>
            </div>

            <div id="adminProducts" class="content-section">
                <div class="table-container">
                    <div class="table-header">
                        <h2 class="table-title">Продукты</h2>
                        <button class="btn-add" data-section="adminProducts">Обновить</button>
                    </div>
                    <div class="settings-section">
                        <div class="settings-title">Создать продукт</div>
                        <form id="adminCreateProductForm">
                            <div class="form-group">
                                <label>Название</label>
                                <input type="text" id="apName" required>
                            </div>
                            <div class="form-group">
                                <label>Цена (₽)</label>
                                <input type="number" id="apPrice" min="0" step="1" required>
                            </div>
                            <div class="form-group">
                                <label>Срок по умолчанию (дней)</label>
                                <input type="number" id="apDays" min="1" value="30">
                            </div>
                            <div class="form-group">
                                <label><input type="checkbox" id="apEnabled" checked> Включён</label>
                            </div>
                            <button type="submit" class="btn btn-inline">Создать</button>
                            <div id="adminProductsMsg" class="error-message hidden"></div>
                        </form>
                    </div>
                    <div class="table-header" style="margin-top:24px;">
                        <h2 class="table-title">Список продуктов</h2>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Название</th>
                                <th>Цена</th>
                                <th>Дней</th>
                                <th>Статус</th>
                                <th>Действия</th>
                            </tr>
                        </thead>
                        <tbody id="adminProductsTable"></tbody>
                    </table>
                </div>
            </div>

            <div id="adminLogs" class="content-section">
                <div class="table-container">
                    <div class="table-header">
                        <h2 class="table-title">Журнал аудита</h2>
                    </div>
                    <div id="adminLogsContainer"></div>
                </div>
            </div>

            <div id="adminInvites" class="content-section">
                <div class="table-container">
                    <div class="table-header">
                        <h2 class="table-title">Инвайты</h2>
                    </div>
                    <div class="settings-section">
                        <div class="settings-title">Создать инвайты</div>
                        <form id="adminCreateInvitesForm">
                            <div class="form-group">
                                <label>Количество</label>
                                <input type="number" id="invCount" min="1" max="100" value="1">
                            </div>
                            <div class="form-group">
                                <label>Срок действия (дней, опционально)</label>
                                <input type="number" id="invExpiresDays" min="1" placeholder="например, 7">
                            </div>
                            <div class="form-group">
                                <label>Или свои коды (по одному в строке)</label>
                                <textarea id="invCodes" rows="3" placeholder="code-1\ncode-2"></textarea>
                            </div>
                            <button type="submit" class="btn">Создать</button>
                            <div id="adminInvitesMsg" class="error-message hidden"></div>
                        </form>
                    </div>
                    <div class="table-header" style="margin-top:24px;">
                        <h2 class="table-title">Список инвайтов</h2>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Код</th>
                                <th>Истекает</th>
                                <th>Использован</th>
                                <th>Действия</th>
                            </tr>
                        </thead>
                        <tbody id="adminInvitesTable"></tbody>
                    </table>
                </div>
            </div>

            <div id="adminSettings" class="content-section">
                <div class="settings-section">
                    <div class="settings-title">Настройки системы</div>
                    <div class="setting-item">
                        <span class="setting-label">Версия системы</span>
                        <span class="setting-value">v1.0.0</span>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">Защита HTTPS</span>
                        <span class="setting-value">Включена</span>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">XSS фильтрация</span>
                        <span class="setting-value">Активна</span>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">Хэширование паролей</span>
                        <span class="setting-value">bcrypt</span>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="settings-title">Статистика системы</div>
                    <div class="cards-grid">
                        <div class="card">
                            <div class="card-title">Всего пользователей</div>
                            <div class="card-value" id="adminTotalUsers">0</div>
                            <div class="card-subtitle">В системе</div>
                        </div>
                        <div class="card">
                            <div class="card-title">Реселлеров</div>
                            <div class="card-value" id="adminTotalResellers">0</div>
                            <div class="card-subtitle">Активных</div>
                        </div>
                        <div class="card">
                            <div class="card-title">Записей в логах</div>
                            <div class="card-value" id="adminTotalLogs">0</div>
                            <div class="card-subtitle">За всё время</div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="adminTelegram" class="content-section">
                <div class="table-container">
                    <div class="table-header">
                        <h2 class="table-title">Telegram — рассылки и заявки на отвязку</h2>
                    </div>
                    <div class="settings-grid">
                        <div class="settings-section">
                            <div class="settings-title">Мой Telegram</div>
                            <div id="adminTelegramSelfContainer"></div>
                        </div>
                        <div class="settings-section">
                            <div class="settings-title">Рассылка</div>
                            <div class="form-group">
                                <label>Текст сообщения</label>
                                <textarea id="adminBroadcastText" rows="3" style="width:100%;"></textarea>
                            </div>
                            <div class="form-group">
                                <label>Аудитория</label>
                                <select id="adminBroadcastAudience">
                                    <option value="all">Все</option>
                                    <option value="User">User</option>
                                    <option value="Reseller">Reseller</option>
                                    <option value="Admin">Admin</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label><input type="checkbox" id="adminBroadcastIncludeGroup"> Также отправить в группу</label>
                            </div>
                            <div style="display:flex; gap:10px; flex-wrap:wrap;">
                                <button id="btnAdminBroadcast" class="btn btn-inline">Отправить</button>
                                <button id="btnCheckBot" class="btn btn-inline">Проверить бота</button>
                            </div>
                            <div id="adminBroadcastResult" style="margin-top:8px;"></div>
                            <div id="adminBotStatusResult" style="margin-top:8px;"></div>
                        </div>
                    </div>
                    <div class="table-header" style="margin-top:24px;">
                        <h2 class="table-title">Заявки на отвязку</h2>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Пользователь</th>
                                <th>Статус</th>
                                <th>Причина</th>
                                <th>Создана</th>
                                <th>Действия</th>
                            </tr>
                        </thead>
                        <tbody id="adminUnlinkRequestsTable"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>


    <script src="/assets/js/api-bridge.js?v=20251107-1" defer></script>
</body>
</html>
