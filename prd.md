### Product Requirements Document (PRD): Панель управления для чит-клиента ZalypaSPB

Версия: 1.1
---

### 1. Введение

#### 1.1. Цель документа
Этот документ описывает функциональные требования, дизайн-концепцию и технические особенности веб-сайта с панелью управления для пользователей чит-клиента. Цель проекта — создать централизованный, безопасный и современный хаб для управления подписками, ключами и загрузками.

#### 1.2. Проблема и возможность
Пользователям currently нет удобного способа проверки статуса подписки, активации ключей и скачивания последней версии лоадера. Администраторам и реселлерам не хватает инструментов для эффективного управления пользовательской базой и отслеживания активности. Данный сайт решает эти проблемы.

#### 1.3. Целевая аудитория
*   Пользователи: Конечные пользователи чит-клиента.
*   Реселлеры: Партнеры, которые продают ключи и привлекают новых пользователей.
*   Администраторы: Технические специалисты и владельцы проекта, осуществляющие полный контроль над системой.

---

### 2. Обзор продукта

#### 2.1. Описание
Это веб-приложение с авторизацией, которое предоставляет пользователям личный кабинет для управления своей подпиской на чит-клиент. Система имеет строгое разделение ролей (User, Reseller, Admin) и закрытую регистрацию по инвайтам.

#### 2.2. Ключевые возможности (Epics)
1.  Аутентификация и авторизация по ролям.
2.  Личный кабинет пользователя: Просмотр статуса подписки, активация ключей, загрузка лоадера.
3.  Панель реселлера: Доступ к инструментам для продажи.
4.  Административная панель: Полный контроль над пользователями, просмотр логов системы.
5.  Ведение журналов действий (Logging).

#### 2.3. Новое в 1.1
*  Авторизация через телеграмм бота + webapp приложение
*  Синхронизация роли подписчика в telegram боте через бота по сроку подписки.
*  Каталог продуктов (общий), цена в копейках, дефолтная длительность.
*  Ведение баланса реселлеров (в копейках).
*  Массовая загрузка ключей с привязкой к продуктам + автосписание баланса.
*  Управление инвайтами (лист/создание/удаление неиспользованных).

---

### 3. Функциональные требования

#### 3.1. Общие функции (доступны всем аутентифицированным пользователям)
*   Личный кабинет: Персональная страница после входа.
*   Профиль: Отображение имени пользователя, telegram, даты регистрации.
*   Статус подписки: Четкое отображение текущего статуса (Активна/Неактивна), даты окончания подписки.
*   Активация ключа: Поле ввода и кнопка для активации нового ключа продукта.
*   Скачивание лоадера: Кнопка для скачивания последней версии загрузчика (Loader) клиента.
*   Выход (Logout): Безопасное завершение сеанса.

#### 3.2. Функции для роли "Реселлер" (Reseller)
*   Доступ к Панели реселлера: Появление дополнительной кнопки Panel в навигации личного кабинета.
*   Генерация инвайт-кодов.
*   Просмотр статистики по своим привлеченным пользователям.
*   Просмотр активных продуктов для продажи (общий каталог продуктов).
*   Покупка ключей за внутренний баланс — опционально, через эндпоинт покупки (резерв ключей из общего пула) или через предзагрузку админом.

#### 3.3. Функции для роли "Администратор" (Admin)
*   Доступ к Админ-панели: Появление кнопки Admin Panel в навигации.
*   Управление пользователями:
    *   Просмотр списка всех пользователей с фильтрацией и поиском.
    *   Администраторы могли вывдовать роли реселлеров и админов.
    *   Блокировка/разблокировка любого пользователя.
    *   Смена пароля любому пользователю.
    *   Мягкое удаление учетной записи пользователя.
*   Управление продуктами: CRUD, включение/выключение, установка цены/длительности.
*   Управление инвайтами: листинг, пакетное создание, удаление неиспользованных.
*   Массовая загрузка ключей: прямо на сайте в удобном ui, привязка к продукту, автосписание баланса согласно цене продукта.

*   Просмотр логов:
    *   Backend-логи: Просмотр системных ошибок, предупреждений и информации о работе сервера (интеграция с файлами логов или сервисами типа Sentry).
    *   Логи действий: Детальная история действий всех пользователей (кто, когда, что сделал: "User [X] активировал ключ [Y]", "Admin [Z] заблокировал пользователя [X]").

---

### 4. Нефункциональные требования

#### 4.1. Дизайн и Пользовательский опыт (UX/UI)
*   Стиль: Современный, минималистичный, с акцентами.
*   Цветовая схема: Темно-оранжевая палитра.
    *   Фон: Темный (например, #121212 или #1E1E1E).
    *   Акцентные цвета: Оранжевый (#FF5722), янтарный (#FF9800), их градиенты и оттенки.
    *   Текст: Светлый (белый или светло-серый #E0E0E0) для контраста.
*   Интерфейс: Интуитивно понятный, с четкой навигацией. Все элементы должны соответствовать выбранной цветовой схеме.

#### 4.2. Производительность и безопасность
*   Производительность: Страницы должны загружаться менее чем за 2 секунды.
*   Безопасность:
    *   Все пароли должны храниться в хешированном виде (алгоритм bcrypt или аналогичный).
    *   Защита от SQL-инъекций и XSS-атак.
    *   Использование HTTPS.
    *   Сессии должны быть защищены и правильно инвалидированы после выхода.
*   Регистрация: Доступна только по инвайтам. Публичная регистрация должна быть отключена.

---

### 5. Бизнес-логика и сценарии использования

#### 5.1. Сценарий: Активация ключа
1.  Пользователь входит в систему.
2.  Переходит в свой личный кабинет.
3.  В разделе "Активация ключа" вводит приобретенный ключ.
4.  Нажимает кнопку "Активировать".
5.  *Бэкенд проверяет:*
    *   Существует ли ключ в базе данных.
    *   Не использован ли он уже.
    *   Не просрочен ли он.
6.  В случае успеха, ключ привязывается к аккаунту пользователя, время подписки обновляется, ключ помечается как использованный.
7.  Пользователь видит сообщение об успехе и обновленный статус подписки.

#### 5.2. Сценарий: Блокировка пользователя администратором
1.  Администратор входит в систему и переходит в Admin Panel.
2.  В списке пользователей находит нужного через поиск.
3.  Нажимает кнопку "Заблокировать" напротив имени пользователя.
4.  *Бэкенд проверяет права администратора.*
5.  Учетная запись пользователя помечается как заблокированная.
6.  В таблицу логов действий записывается событие: [Admin: username] заблокировал пользователя [User: target_username] в [timestamp].
7.  При следующей попытке входа пользователь получает ошибку "Ваш аккаунт заблокирован".

#### 5.3. Сценарий: Загрузка ключей администратором с привязкой к реселлеру
1.  Админ формирует вписывает на сайте ключи одна строка - 1 ключ, указывает `productId`..
2.  Система валидирует существование продукта.
4.  Вставка ключей транзакционно; баланс реселлера списывается.
5.  Ключи становятся "закреплёнными" за реселлером до момента продажи конечному пользователю.

#### 5.4. Сценарий: Покупка ключа реселлером (вариант с общим пулом)
1.  Реселлер выбирает продукт из общего каталога.
2.  Отправляет запрос на покупку; система ищет свободный ключ по `product_id` без владельца.
3.  Проверяется баланс; при успехе — списание, назначение `owner_reseller_id` и возврат ключа.
4.  Все операции в транзакции, с логированием.

---

### 6. Дополнительные разделы (При необходимости)

*   API: Рассмотреть возможность создания внутреннего API для будущей интеграции с другими сервисами (например, ботом в Discord для проверки подписки).

---

Лоадеры загружаются на сервер администраторами
Также нужно чтобы в боте можно было рассылать сообщения от администраторов, новости рекламу и т.д.
Блокировка пользователей чтобы была синхронизирована с баном на сайте.
